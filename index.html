<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voter Information Slip</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===== SCREEN ===== */
body {
  font-family: Arial, sans-serif;
  background: url("background.jpg") center/cover no-repeat;
  margin: 0;
  padding: 10px;
}

.container {
  max-width: 640px;
  margin: auto;
  background: rgba(255,255,255,0.97);
  border: 1px solid #000;
  padding: 10px;
}

select, input, button {
  width: 100%;
  padding: 6px;
  margin: 5px 0;
  font-size: 14px;
}

.results {
  margin-top: 10px;
}

/* ===== SLIP (LANDSCAPE) ===== */
.slip {
  display: flex;
  border: 1px dashed #000;
  margin-bottom: 10px;
  font-size: 12px;
}

/* LEFT SIDE – CANDIDATE */
.left {
  width: 35%;
  border-right: 1px solid #000;
  text-align: center;
  padding: 8px;
}

.left img {
  width: 70px;
  margin-bottom: 4px;
}

.left .title {
  font-weight: bold;
  font-size: 13px;
}

.left .sub {
  font-size: 11px;
}

/* RIGHT SIDE – VOTER */
.right {
  width: 65%;
  padding: 8px;
}

.right p {
  margin: 3px 0;
}

.print-btn {
  margin-top: 6px;
  padding: 6px;
  font-size: 13px;
}

/* ===== PRINT (80mm ROLL) ===== */
@media print {
  @page {
    size: 80mm auto;
    margin: 0;
  }

  body * {
    visibility: hidden !important;
  }

  .print-area,
  .print-area * {
    visibility: visible !important;
  }

  .print-area {
    position: absolute;
    left: 0;
    top: 0;
    width: 80mm;
    padding: 4mm;
  }

  button {
    display: none !important;
  }

  body {
    background: none !important;
  }
}
</style>
</head>

<body>

<div class="container">

  <!-- SEARCH -->
  <select id="searchType">
    <option value="epic_no">Search by EPIC No</option>
    <option value="name">Search by Name</option>
    <option value="house_No">Search by House No</option>
    <option value="mobile_no">Search by Mobile No</option>
  </select>

  <input id="search" placeholder="Enter value">
  <button onclick="findVoter()">Search</button>

  <div id="result" class="results"></div>

</div>

<script>
let voters = [];

/* LOAD DATA */
fetch("https://opensheet.elk.sh/1xfIMsplZ_b4X4VI6D0AKUK5sQnVPRPFFgOhgJZUgAMc/Sheet1!A1:Z")
  .then(res => res.json())
  .then(data => voters = data);

/* NORMALIZE */
function normalize(v) {
  return String(v || "")
    .trim()
    .toUpperCase()
    .replace(/\s+/g, "");
}

/* SEARCH */
function findVoter() {
  const type = document.getElementById("searchType").value;
  const input = normalize(document.getElementById("search").value);
  const result = document.getElementById("result");

  result.innerHTML = "";

  const matches = voters.filter(v =>
    normalize(v[type]).includes(input)
  );

  if (!matches.length) {
    result.innerHTML = "<b>No record found</b>";
    return;
  }

  matches.forEach(v => {
    const slip = document.createElement("div");
    slip.className = "slip";

    slip.innerHTML = `
      <div class="left">
        <img src="hand.png">
        <div class="title">Vote for Congress ✋</div>
        <div class="sub">
          Sarilla Raja Kumari<br>
          52 Division<br>
          Ballot No: <b>6</b>
        </div>
      </div>

      <div class="right">
        <p><b>Voter ID:</b> ${v.epic_no || ""}</p>
        <p><b>Name:</b> ${v.name || ""}</p>
        <p><b>${v.relation || ""}:</b> ${v.relation_name || ""}</p>
        <p><b>House No:</b> ${v.house_No || ""}</p>
        <p><b>PS:</b> ${v.ps_location || ""}</p>
        <p><b>Serial:</b> ${v.serial_no || ""}</p>
        <p><b>Age / Gender:</b> ${v.age || ""} | ${v.gender || ""}</p>

        <button class="print-btn" onclick="printSlip(this)">Print</button>
      </div>
    `;

    result.appendChild(slip);
  });
}

/* MOBILE SAFE PRINT */
function printSlip(btn) {
  document.querySelectorAll(".print-area")
    .forEach(e => e.classList.remove("print-area"));

  btn.closest(".slip").classList.add("print-area");

  setTimeout(() => {
    window.print();
  }, 300);
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voter Information Slip</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  margin: 0;
}

.box {
  width: 100%;
  max-width: 360px;
  margin: 10px auto;
  background: #fff;
  border: 1px solid #000;
  padding: 8px;
}

h3 {
  text-align: center;
  margin: 6px 0;
  font-size: 16px;
}

select, input, button {
  width: 100%;
  padding: 8px;
  margin: 6px 0;
  font-size: 14px;
}

.result-card {
  border-top: 1px dashed #000;
  margin-top: 8px;
  padding-top: 6px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.card-header input {
  width: auto;
}

p {
  font-size: 12px;
  margin: 3px 0;
}

.footer {
  font-size: 9px;
  text-align: center;
  margin-top: 6px;
}

/* PRINT */
@media print {
  @page {
    size: 80mm auto;
    margin: 0;
  }

  body * {
    visibility: hidden;
  }

  .print-area, .print-area * {
    visibility: visible;
  }

  .print-area {
    position: absolute;
    left: 0;
    top: 0;
    width: 80mm;
  }

  .no-print {
    display: none;
  }

  .result-card {
    page-break-after: always;
  }

  .result-card:last-child {
    page-break-after: auto;
  }
}
</style>
</head>

<body>

<div class="box no-print">
  <h3>Voter Information Slip</h3>

  <select id="searchType">
    <option value="epic_no">Search by EPIC No</option>
    <option value="name">Search by Name</option>
    <option value="house_No">Search by House No</option>
    <option value="mobile_no">Search by Mobile No</option>
  </select>

  <input id="search" placeholder="Enter value">

  <button onclick="findVoter()">Search</button>

  <button onclick="printSelected()">Print Selected</button>
</div>

<div id="result" class="print-area"></div>

<script>
let voters = [];

/* LOAD DATA */
fetch("https://opensheet.elk.sh/1xfIMsplZ_b4X4VI6D0AKUK5sQnVPRPFFgOhgJZUgAMc/Sheet1!A1:Z")
  .then(res => res.json())
  .then(data => voters = data);

/* NORMALIZE */
function normalize(val) {
  return String(val || "").trim().toUpperCase().replace(/\s+/g, "");
}

/* SEARCH */
function findVoter() {
  const type = document.getElementById("searchType").value;
  const input = normalize(document.getElementById("search").value);

  const matches = voters.filter(v =>
    normalize(v[type]) === input
  );

  if (!matches.length) {
    document.getElementById("result").innerHTML =
      "<p><b>No record found</b></p>";
    return;
  }

  document.getElementById("result").innerHTML = matches.map((v, i) => `
    <div class="result-card" id="card-${i}">
      <div class="card-header no-print">
        <label>
          <input type="checkbox" class="selectBox" data-id="${i}">
          Select
        </label>
        <button onclick="printOne(${i})">Print</button>
      </div>

      <p><b>Name:</b> ${v.name}</p>
      <p><b>Relation:</b> ${v.relation_name}</p>
      <p><b>House No:</b> ${v.house_No}</p>
      <p><b>PS Location:</b> ${v.ps_location}</p>
      <p><b>Serial No:</b> ${v.serial_no}</p>
      <p><b>Age:</b> ${v.age}</p>
      <p><b>Gender:</b> ${v.gender}</p>

      <p style="font-size:9px;text-align:center;">
        This is NOT an official voter slip
      </p>
    </div>
  `).join("");
}

/* PRINT SINGLE */
function printOne(id) {
  const content = document.getElementById(`card-${id}`).outerHTML;
  document.getElementById("result").innerHTML = content;
  window.print();
  findVoter(); // reload results after print
}

/* PRINT SELECTED */
function printSelected() {
  const selected = [...document.querySelectorAll(".selectBox:checked")]
    .map(cb => document.getElementById(`card-${cb.dataset.id}`).outerHTML)
    .join("");

  if (!selected) {
    alert("Please select at least one voter");
    return;
  }

  document.getElementById("result").innerHTML = selected;
  window.print();
  findVoter();
}
</script>

</body>
</html>
